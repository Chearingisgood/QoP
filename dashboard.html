<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Volunteer Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 p-6">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-2xl font-bold text-indigo-700 mb-4">Volunteer Dashboard</h1>

    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="font-semibold">Register / Log Hours</h2>
      <form id="regForm" class="space-y-2">
        <input id="email" placeholder="Your email" class="w-full border rounded px-2 py-1" />
        <select id="eventSelect" class="w-full border rounded px-2 py-1"></select>
        <input id="hours" type="number" placeholder="Hours (e.g. 2.5)" class="w-full border rounded px-2 py-1" />
        <input id="notes" placeholder="Notes (optional)" class="w-full border rounded px-2 py-1" />
        <div class="flex gap-2">
          <button class="bg-indigo-600 text-white px-3 py-1 rounded">Register for Event</button>
          <button id="logBtn" type="button" class="bg-green-600 text-white px-3 py-1 rounded">Log Hours</button>
        </div>
      </form>
      <div id="msg" class="mt-2 text-sm text-green-600"></div>
    </div>

    <div id="myEntries" class="bg-white p-4 rounded shadow">
      <h2 class="font-semibold">Your Entries</h2>
      <pre id="entriesPre" class="text-xs bg-gray-100 p-2 rounded max-h-48 overflow-auto"></pre>
    </div>
  </div>

<script>
async function loadEvents(){
  const r = await fetch('/api/events');
  const events = await r.json();
  const sel = document.getElementById('eventSelect');
  sel.innerHTML = '';
  for (const e of events){
    const opt = document.createElement('option');
    opt.value = e.id;
    opt.textContent = `${e.title} (${e.date})`;
    sel.appendChild(opt);
  }
}

document.getElementById('regForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const eventId = document.getElementById('eventSelect').value;
  const res = await fetch(`/api/events/${eventId}/register`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ volunteerEmail: email })
  });
  const j = await res.json();
  if (res.ok) { document.getElementById('msg').textContent = 'Registered!'; } else { document.getElementById('msg').textContent = j.message || 'Error'; }
});

document.getElementById('logBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const eventId = document.getElementById('eventSelect').value;
  const hours = document.getElementById('hours').value;
  const notes = document.getElementById('notes').value;
  const res = await fetch('/api/hours', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ volunteerEmail: email, eventId, hours, notes })
  });
  const j = await res.json();
  if (res.ok) { document.getElementById('msg').textContent = 'Hours logged'; fetchMyEntries(email); }
  else document.getElementById('msg').textContent = j.message || 'Error';
});

async function fetchMyEntries(email){
  if (!email) return;
  const r = await fetch('/api/hours');
  if (!r.ok) return;
  const all = await r.json();
  const mine = all.filter(x => x.volunteerEmail === email);
  document.getElementById('entriesPre').textContent = JSON.stringify(mine, null, 2);
}

document.getElementById('email').addEventListener('change', (e) => fetchMyEntries(e.target.value));
loadEvents();
</script>
</body>
</html>